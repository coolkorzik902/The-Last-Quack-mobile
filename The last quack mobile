<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>The Last Quack | Mobile Adaptive</title>
    <style>
        * { box-sizing: border-box; touch-action: none; -webkit-user-select: none; user-select: none; }
        
        body { 
            margin: 0; background: #000; color: #0f0; 
            font-family: 'Courier New', monospace; 
            overflow: hidden; height: 100vh; width: 100vw;
            display: flex; justify-content: center; align-items: center;
        }

        /* Контейнер гри тепер гнучкий */
        #game-wrapper { 
            width: 100%; height: 100%; 
            position: relative; overflow: hidden;
            display: flex; flex-direction: column;
        }

        /* HUD адаптується до ширини */
        #hud { 
            position: absolute; top: env(safe-area-inset-top, 20px); 
            width: 100%; display: flex; justify-content: space-around; 
            font-size: clamp(14px, 4vw, 24px); z-index: 100; text-shadow: 2px 2px #000;
        }

        #viewport { flex: 1; position: relative; transition: transform 0.4s ease-in-out; }
        
        .room-bg { position: absolute; width: 400%; height: 100%; display: flex; }
        
        .zone { 
            width: 25%; height: 100%; position: relative; 
            background: #050505; display: flex; justify-content: center; align-items: center; 
        }
        
        .zone.light-on { background: #1a1a1a !important; box-shadow: inset 0 0 100px #000; }

        /* Двері тепер займають % від висоти екрану */
        .door-frame { 
            position: absolute; bottom: 0; width: 80%; height: 85%; 
            background: #020202; overflow: hidden; border-top: 10px solid #333; 
        }
        
        .door { 
            position: absolute; width: 100%; height: 100%; background: #1a1a1a; 
            border: 15px solid #222; border-bottom: 40px solid #333;
            z-index: 10; top: -100%; transition: top 0.25s ease-in; 
        }
        .door.closed { top: 0 !important; }

        /* Качка адаптивного розміру */
        .duck-container { 
            width: 40vh; height: 40vh; max-width: 70vw; max-height: 70vw;
            background: #f1c40f; border-radius: 50% 50% 45% 45%; 
            position: relative; cursor: pointer; border-bottom: 10px solid #c7a60a; 
        }
        .eye { position: absolute; width: 12%; height: 12%; background: #000; border-radius: 50%; top: 25%; }
        .beak { position: absolute; width: 40%; height: 20%; background: #e67e22; border-radius: 50px; top: 45%; left: 30%; }

        /* Навігація внизу */
        .nav-controls { 
            width: 100%; background: #0a0a0a; padding: 10px;
            display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px;
            padding-bottom: env(safe-area-inset-bottom, 15px);
        }
        
        .btn-nav { 
            background: #111; color: #f1c40f; border: 2px solid #f1c40f; 
            padding: 12px 2px; font-size: clamp(10px, 3vw, 16px); 
            border-radius: 8px; font-weight: bold;
        }
        .active-light { background: #f1c40f !important; color: #000 !important; }

        /* Монстр */
        .xenomorph { 
            position: absolute; bottom: 0; width: 100%; height: 80%; 
            z-index: 5; display: none; background: #0a0a0a; 
            clip-path: polygon(50% 0%, 100% 20%, 85% 100%, 15% 100%, 0% 20%); 
        }
        .eye-glow { position: absolute; top: 20%; width: 10%; height: 5%; background: #f00; border-radius: 50%; box-shadow: 0 0 40px 10px #f00; }

        #start-screen, #jumpscare { 
            position: absolute; inset: 0; background: #000; z-index: 10000; 
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
        }

        @keyframes doorPunch { 0%, 100% { transform: scale(1); } 50% { transform: scale(0.98); } }
        .shake-active { animation: doorPunch 0.2s; }
    </style>
</head>
<body>

<div id="game-wrapper">
    <div id="start-screen">
        <h1 style="font-size: 8vw; color:#f1c40f; margin-bottom: 20px;">THE LAST QUACK</h1>
        <button class="btn-nav" style="font-size: 5vw; padding: 15px 40px;" onclick="startGame()">WAKE UP</button>
    </div>

    <div id="jumpscare" style="display:none;">
        <h1 style="font-size: 10vw; color: #f00;">GAME OVER</h1>
        <p id="death-msg" style="font-size: 5vw; color: #fff;"></p>
    </div>

    <div id="hud">
        <div id="game-time">12:00 AM</div>
        <div style="color: #0ff;">PWR: <span id="energy-val">100</span>%</div>
        <div style="color: #f0f;">SAN: <span id="sanity-val">100</span>%</div>
    </div>

    <div id="viewport">
        <div class="room-bg" id="slider">
            <div class="zone" id="z0">
                <div class="door-frame" ontouchstart="setDoor('l', true)" ontouchend="setDoor('l', false)" onmousedown="setDoor('l', true)" onmouseup="setDoor('l', false)">
                    <div id="x-l" class="xenomorph"><div class="eye-glow" style="left:15%;"></div><div class="eye-glow" style="right:15%;"></div></div>
                    <div id="d-l" class="door"></div>
                </div>
            </div>
            <div class="zone" id="z1">
                <div class="duck-container" onclick="quack()">
                    <div class="eye" style="left:20%;"></div><div class="eye" style="right:20%;"></div><div class="beak"></div>
                </div>
            </div>
            <div class="zone" id="z2">
                <div class="door-frame" ontouchstart="setDoor('r', true)" ontouchend="setDoor('r', false)" onmousedown="setDoor('r', true)" onmouseup="setDoor('r', false)">
                    <div id="x-r" class="xenomorph"><div class="eye-glow" style="left:15%;"></div><div class="eye-glow" style="right:15%;"></div></div>
                    <div id="d-r" class="door"></div>
                </div>
            </div>
            <div class="zone" id="z3">
                <button class="btn-nav" style="width:50vw; height:50vw; border-radius:50%; font-size:4vw;" ontouchstart="startCharge()" ontouchend="stopCharge()" onmousedown="startCharge()" onmouseup="stopCharge()">RECHARGE</button>
            </div>
        </div>
    </div>

    <div class="nav-controls">
        <button class="btn-nav" onclick="move(0)">LEFT</button>
        <button id="light-btn" class="btn-nav" ontouchstart="setLight(true)" ontouchend="setLight(false)" onmousedown="setLight(true)" onmouseup="setLight(false)">LIGHT</button>
        <button class="btn-nav" onclick="move(1)">FRONT</button>
        <button class="btn-nav" onclick="move(2)">RIGHT</button>
        <button class="btn-nav" onclick="move(3)">BACK</button>
    </div>
</div>

<script>
    let energy = 100, sanity = 100, hour = 12, minute = 0, gameStarted = false;
    let monsterSide = "", currentPos = 1, isFlashlight = false;
    let doors = { l: false, r: false }, doorTimer = 0;
    
    const audio = new (window.AudioContext || window.webkitAudioContext)();

    function playSound(f, d, v=0.1) {
        let o = audio.createOscillator(), g = audio.createGain();
        o.frequency.value = f; g.gain.exponentialRampToValueAtTime(v, audio.currentTime + d);
        o.connect(g); g.connect(audio.destination); o.start(); o.stop(audio.currentTime + d);
    }

    function startGame() {
        audio.resume();
        document.getElementById('start-screen').style.display = 'none';
        gameStarted = true;
        
        setInterval(() => {
            if (!gameStarted) return;
            if (isFlashlight || doors.l || doors.r) energy -= 2;
            if (!isFlashlight && currentPos !== 1) sanity -= 1;
            if (currentPos === 1) sanity = Math.min(100, sanity + 2);

            if (monsterSide !== "") {
                if (doors[monsterSide === 'left' ? 'l' : 'r']) {
                    doorTimer++;
                    if (doorTimer >= 3) { monsterSide = ""; doorTimer = 0; playSound(40, 0.5); }
                } else if (Math.random() < 0.1) triggerGameOver("SECURITY BREACH");
            }

            if (energy <= 0) triggerGameOver("POWER OUT");
            if (sanity <= 0) triggerGameOver("INSANITY");

            minute++;
            if (minute >= 60) { minute = 0; hour = (hour === 12) ? 1 : hour + 1; }
            document.getElementById('game-time').innerText = `${hour}:${minute < 10 ? '0'+minute : minute} AM`;
            document.getElementById('energy-val').innerText = Math.floor(energy);
            document.getElementById('sanity-val').innerText = Math.floor(sanity);
        }, 1000);

        setInterval(() => {
            if (gameStarted && monsterSide === "" && Math.random() < 0.5) {
                monsterSide = Math.random() > 0.5 ? "left" : "right";
            }
            updateView();
        }, 4000);
    }

    function setDoor(s, v) {
        if (!gameStarted || (v && energy <= 0)) return;
        doors[s] = v;
        document.getElementById('d-'+s).classList.toggle('closed', v);
        if (v) { playSound(60, 0.2); document.getElementById('game-wrapper').classList.add('shake-active'); setTimeout(()=>document.getElementById('game-wrapper').classList.remove('shake-active'), 200); }
    }

    function move(p) {
        currentPos = p;
        document.getElementById('slider').style.transform = `translateX(-${p * 25}%)`;
        playSound(150, 0.05);
        updateView();
    }

    function setLight(v) {
        if (energy > 0) {
            isFlashlight = v;
            document.getElementById('light-btn').classList.toggle('active-light', v);
            updateView();
        }
    }

    function quack() { sanity = Math.min(100, sanity + 15); playSound(400, 0.2); }

    let cInt;
    function startCharge() { if (currentPos === 3) cInt = setInterval(() => { energy = Math.min(100, energy + 5); playSound(200, 0.1); }, 400); }
    function stopCharge() { clearInterval(cInt); }

    function updateView() {
        for(let i=0; i<4; i++) document.getElementById('z'+i).classList.toggle('light-on', isFlashlight && currentPos === i);
        document.getElementById('x-l').style.display = (isFlashlight && monsterSide === 'left' && currentPos === 0) ? 'block' : 'none';
        document.getElementById('x-r').style.display = (isFlashlight && monsterSide === 'right' && currentPos === 2) ? 'block' : 'none';
    }

    function triggerGameOver(m) {
        gameStarted = false;
        document.getElementById('death-msg').innerText = m;
        document.getElementById('jumpscare').style.display = 'flex';
        setTimeout(() => location.reload(), 4000);
    }
</script>
</body>
</html>
